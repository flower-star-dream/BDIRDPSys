# SpringBoot应用配置
server:
  port: 8080
  tomcat:
    max-connections: 8192
    accept-count: 100
    max-threads: 200
    min-spare-threads: 10

# Spring配置
spring:
  application:
    name: bdir-dps-web

  profiles:
    active: dev

  # 数据源配置
  datasource:
    url: jdbc:mysql://localhost:3306/bdir_dps?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: bdir_user
    password: bdir_pass
    driver-class-name: com.mysql.cj.jdbc.Driver
    type: com.zaxxer.hikari.HikariDataSource
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      connection-test-query: SELECT 1

  # Redis配置
  redis:
    host: localhost
    port: 6379
    password:
    database: 0
    timeout: 5000
    lettuce:
      pool:
        max-active: 20
        max-idle: 10
        min-idle: 0
        max-wait: 1000ms

  # Kafka配置
  kafka:
    bootstrap-servers: localhost:9092
    producer:
      retries: 3
      batch-size: 32768
      buffer-memory: 33554432
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.apache.kafka.common.serialization.StringSerializer
      acks: all
    consumer:
      group-id: bdir-dps-consumer
      enable-auto-commit: false
      auto-offset-reset: earliest
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      max-poll-records: 500
      isolation-level: read_committed
    listener:
      ack-mode: manual
      concurrency: 3

  # MyBatis-Plus配置
  mybatis-plus:
    mapper-locations: classpath:mapper/*.xml
    type-aliases-package: com.bdir.dps.entity
    configuration:
      map-underscore-to-camel-case: true
      cache-enabled: true
      lazy-loading-enabled: true
      multiple-result-sets-enabled: true
      use-column-label: true
      default-executor-type: reuse
      default-statement-timeout: 25000
      log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
    global-config:
      db-config:
        id-type: assign_id
        logic-delete-field: deleted
        logic-delete-value: 1
        logic-not-delete-value: 0

  # 数据源动态配置
  dynamic:
    datasource:
      primary: master
      strict: false
      datasource:
        master:
          url: jdbc:mysql://localhost:3306/bdir_dps?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
          username: bdir_user
          password: bdir_pass
          driver-class-name: com.mysql.cj.jdbc.Driver
        hive:
          url: jdbc:hive2://localhost:10000/default
          username: hive
          password: hive
          driver-class-name: org.apache.hive.jdbc.HiveDriver

  # 缓存配置
  cache:
    type: redis
    redis:
      time-to-live: 3600000 # 1小时
      cache-null-values: false
      key-prefix: bdir:cache:

  # 文件上传配置
  servlet:
    multipart:
      max-file-size: 100MB
      max-request-size: 100MB

  # 国际化配置
  messages:
    basename: i18n/messages
    encoding: UTF-8
    cache-duration: 3600

  # Jackson配置
  jackson:
    date-format: yyyy-MM-dd HH:mm:ss
    time-zone: GMT+8
    default-property-inclusion: non_null
    serialization:
      write-dates-as-timestamps: false
      write-date-timestamps-as-nanoseconds: false
    deserialization:
      read-date-timestamps-as-nanoseconds: false

# 日志配置
logging:
  level:
    root: INFO
    com.bdir.dps: DEBUG
    org.apache.kafka: WARN
    org.apache.hadoop: WARN
    org.apache.hive: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/bdir-dps.log
    max-size: 100MB
    max-history: 30

# Actuator监控配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,env,beans,conditions,configprops,loggers,heapdump,threaddump
      base-path: /actuator
  endpoint:
    health:
      show-details: always
      show-components: always
    metrics:
      enabled: true
    prometheus:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: ${spring.application.name}
      environment: ${spring.profiles.active}

# 应用自定义配置
app:
  jwt:
    secret: ${app.jwt.secret:BDIRSecretKey2026ForJWTTokenGenerationAndValidation}
    expiration: 86400000 # 24小时
    refresh-expiration: 604800000 # 7天
  kafka:
    topics:
      sensor-data: sensor-data
      robot-control: robot-control
      system-log: system-log
    partitions: 3
    replication-factor: 1
  hadoop:
    name-node: hdfs://localhost:9000
    resource-manager: localhost:8032
    user: hdfs
  hive:
    warehouse-dir: /user/hive/warehouse
    metastore-uris: thrift://localhost:9083
  data:
    retention:
      days: 90
    compression:
      enabled: true
      algorithm: GZIP
      threshold:
        days: 30
      delete-original: false
      buffer-size: 8192
    backup:
      enabled: true
      location: /backup/bdir-dps
      retention:
        days: 30
      cleanup:
        cron: "0 0 2 * * ?" # 每天凌晨2点清理
      temp-dir: /tmp/bdir-backup
  robot:
    max-connections: 100
    heartbeat-timeout: 30000
    command-timeout: 5000

# 线程池配置
async:
  executor:
    core-pool-size: 10
    max-pool-size: 50
    queue-capacity: 1000
    keep-alive-seconds: 300
    thread-name-prefix: BDIR-Async-

# WebSocket端点配置
websocket:
  endpoint: /ws
  allowed-origins: "*"

# 安全配置
security:
  jwt:
    secret: ${app.jwt.secret}
    expiration: ${app.jwt.expiration}
    refresh-expiration: ${app.jwt.refresh-expiration}

# 自定义配置
info:
  app:
    name: ${spring.application.name}
    description: 大数据智能机器人数据处理系统
    version: 1.0.0
    author: BDIR Team

# 外部化配置支持
---
spring:
  profiles: dev
  datasource:
    url: jdbc:mysql://localhost:3306/bdir_dps?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: bdir_user
    password: bdir_pass

---
spring:
  profiles: test
  datasource:
    url: jdbc:mysql://localhost:3306/bdir_dps_test?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: bdir_user
    password: bdir_pass

---
spring:
  profiles: prod
  datasource:
    url: jdbc:mysql://prod-mysql:3306/bdir_dps_prod?useUnicode=true&characterEncoding=utf8&useSSL=true&serverTimezone=Asia/Shanghai
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}